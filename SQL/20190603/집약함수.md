#### 집약함수

* COUNT : 테이블 레코드 수를 계산한다.
* SUM : 숫자열 데이터의 합계를 구한다.
* AVG : 숫자열 데이터의 평균을 구한다.
* MAX : 임의 열이 가진 데이터의 최댓값을 구한다.
* MIN : 임의 열이 가진 데이터의 최솟값을 구한다.



```SQL
SELECT COUNT(*) FROM EMP;
SELECT SUM(SAL) FROM EMP;
SELECT MAX(SAL) AS CNT FROM EMP;
```



집합함수의 결과는 한개가 나온다.



##### NULL을 제외하고 행 수를 계산한다.



NULL값을 제외하고 계산한다. NULL인 사람도 보기위해선?

```SQL
SELECT COUNT(NVL(COMM,0)) AS CNT FROM EMP
SELECT ROUND(AVG(NVL(COMM,0)),2) AS CNT FROM EMP --- TRUNK는 버림
```

단, 'COUNT(*)'만은 예외적으로 NULL을 포함한다.

```SQL
SELECT MIN(HIREDATE) FROM EMP
--- 날짜에 MIN MAX를 사용할 수 있다.


```

##### 집약 함수 사용 시 중복값제외(DISTINCT 키워드)

```SQL
SELECT SUM(SAL), SUM(DISTINCT SAL) FROM EMP
--- DISTINCT를 사용하여 중복제거를 할 수 있다.

```

#### 테이블을 그룹으로 나눈다

##### GROUP BY 구

```SQL
SELECT JOB FROM EMP GROUP BY JOB
--- GROUP BY로 나눈다.
SELECT JOB,SUM(SAL) FROM EMP GROUP BY JOB
--- SUM과 그룹의 갯수가 다르므로 SUM을 사용하여 그룹함수를 사용할 수 있다.
SELECT DEPTNO,JOB FROM EMP GROUP BY DEPTNO,JOB
--- 그룹별 , 직업별 출력
SELECT DEPTNO,JOB FROM EMP GROUP BY DEPTNO,JOB 
HAVING DEPTNO IN(10,20) ORDER BY DEPTNO
--- 그룹함수는 HAVING을 사용하여 건을 넣을 수 있다.

GROUPING 이전의 조건은 WHERE
EX)
SELECT JOB, AVG(SAL) FROM EMP WHERE DEPTNO IN(10,20) GROUP BY JOB
```

DEPTNO 별 JOB 별 월급의 평균을 구하시오

단, 이름에 A가 들어간 직원들을 대상으로 하시고

DEPNO 20,30 인 부서를 대상으로 하시오 또한 월급의 평균이 3000이상인 것을 대상으로 하시오.





##### VIEW



```SQL
CREATE VIEW EMPSALVIEW(ENAME,ANNSAL)
AS
SELECT ENAME, (SAL*12)+(NVL(COMM,0)*12)
FROM EMP

SELECT * FROM EMPSALVIEW
```



### 서브쿼리

```SQL
CREATE TABLE ITEM(
ID VARCHAR2(10),
NAME VARCHAR2(20),
CATE NUMBER(10)

)
CREATE TABLE CATEGORY(
NO NUMBER(10),
NAME VARCHAR2(20)
)

ALTER TABLE ITEM ADD  PRIMARY KEY(ID)
ALTER TABLE CATEGORY ADD  PRIMARY KEY(NO)


ALTER TABLE ITEM ADD FOREIGN KEY (CATE)
REFERENCES CATEGORY (NO)
--- ITEM 의 CATE를 CATEGORY FOREIGN KEY로 지정
*** PRIAMRY KEY 와 FOREIGN KEY로 연결되어야함
--- 서브쿼리 SQL문 안에 SQL문 
SELECT ENAME FROM EMP
WHERE DEPTNO = (SELECT DEPTNO FROM DEPT WHERE LOC = 'DALLAS')
```

SAL의 평균보다 많이 받는 사람들의 이름과 SAL을 출력하시오

``` SQL
SELECT ENAME,SAL FROM EMP
WHERE SAL >(SELECT  AVG(SAL) FROM EMP)

SELECT ENAME,SAL FROM EMP
WHERE SAL >(SELECT  AVG(SAL) FROM EMP)
AND (
DEPTNO IN (SELECT DEPTNO FROM DEPT WHERE LOC IN ('DALLAS','CHICAGO'))
)

--- 이람마다 평균을 출력하고 싶다면 서브쿼리를 사용한ㄷ.
SELECT ENAME, SAL ,(SELECT AVG(SAL) FROM EMP) FROM EMP
```



부서 별 월급의 평균을 구하고자 한다.

이중 전체 평균보다 높은 부서만 출력 한다.

단 , NEW YORK 부서는 제외한다.



```SQL
SELECT DEPTNO,AVG(SAL) FROM EMP
GROUP BY DEPTNO
HAVING AVG(SAL)> (SELECT AVG(SAL) FROM EMP)
AND DEPTNO NOT IN (SELECT DEPTNO FROM DEPT WHERE LOC IN('NEW YORK')) ㄴ
```

#### 상관 서브쿼리

jOB 별 평균 월급 보다 많이 받는 사람을 조회 하시오





```SQL
SELECT JOB,ENAME,SAL FROM EMP E1
WHERE SAL > (SELECT AVG(SAL) FROM EMP E2 WHERE E2.JOB = E1.JOB GROUP BY JOB  )
```



부서별 월급의 평ㄱ균보다 많이 바든 사람의 DEPTNO,ENAME,SAL을 조회 하시오



```SQL
SELECT DEPTNO,ENAME,SAL FROM EMP E1
WHERE SAL IN (SELECT MAX(SAL) FROM EMP E2 WHERE E2.DEPTNO= E1.DEPTNO AND DEPTNO NOT IN (SELECT DEPTNO FROM DEPT WHERE DNAME = 'ACCOUNTING') GROUP BY DEPTNO)
```

#### 테이블을 합친다.

```sql
SELECT E.EMPNO, E.ENAME, D.DNAME, D.LOC FROM EMP E, DEPT D


```

지역 별 월급의 평균을 구하시오

```SQL
SELECT D.LOC, AVG(E.SAL) FROM EMP E, DEPT D
WHERE E.DEPTNO = D.DEPTNO GROUP BY D.LOC
```

DNAME 별 월급이 가장 많이 받는 사람의  DNAME, ENAME, SAL 을 조회 하시오

단 81ㄴ년도에 고용되고, 이름에 e가 들어간다. 또한 부서명 ACCOUNTING은 제외 하시오.