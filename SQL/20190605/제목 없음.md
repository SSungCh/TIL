



내가 속한 각 부서별 월급이 가장 많이 받는 직원들을 조회 하시오

단 부서명과 지역을 출력하시오



```SQL
SELECT E1.ENAME, E1.SAL, D.DEPTNO, D.LOC FROM EMP E1, DEPT D
WHERE E1.DEPTNO = D.DEPTNO AND
SAL >= (SELECT AVG(SAL) FROM EMP E2
WHERE E1.DEPTNO = E2.DEPTNO
GROUP BY DEPTNO)
```

CASE, WHEN THEN 은 COLUMN 이 새로 만들어진다.



##### EXISTS 술어

NOT IN ,IN 을 통해 거의 동일한 결과를 만들수 있다.



> SCOTT 이 소속된 부서의 직원 정보를 조회 하시오
>
> ``` SQL
> SELECT E1.ENAME, E1.SAL, D.DEPTNO FROM EMP E1, DEPT D
> WHERE E1.DEPTNO = D.DEPTNO AND
> E1.DEPTNO IN (SELECT DEPTNO FROM EMP WHERE ENAME = 'SCOTT')
> 
> 
> SELECT E1.ENAME, E1.SAL, D.DEPTNO FROM EMP E1, DEPT D
> WHERE E1.DEPTNO = D.DEPTNO AND
> EXISTS (SELECT DEPTNO FROM EMP WHERE LOC = 'DALLAS')
> -- EXISTS의 조건이 TRUE이면 출력하시오
> ```

> JONES 가 속한 JOB의 직원을 조회 하시오
>
> ```SQL
> SELECT ENAME,JOB,SAL FROM EMP
> WHERE JOB = (SELECT JOB FROM EMP WHERE ENAME = 'JONES')
> 
> 
> SELECT ENAME,JOB,SAL FROM EMP E1
> WHERE EXISTS (SELECT JOB FROM EMP E2 WHERE ENAME = 'JONES' AND E1.JOB = E2.JOB)
> ```
>
> MANAGER 와 SALESMAN 직원들의 이름과 JOB 을 조회 하시오
>
> ```SQL
> SELECT ENAME,JOB FROM EMP
> WHERE JOB = 'MANAGER'
> UNION
> SELECT ENAME, JOB FROM EMP
> WHERE JOB = 'SALESMAN'
> --- UNION을 사용하여 합침
> 
> SELECT ENAME,JOB FROM EMP
> WHERE JOB = 'MANAGER'
> UNION
> SELECT ENAME, TO_CHAR(HIREDATE,'YYYY/MM/DD') FROM EMP
> WHERE JOB = 'SALESMAN'
> ```
>
> ---
>
> ```sql
> 
> ```
>
> 

#### INNER JOIN

```SQL
SELECT E.ENAME,D.LOC FROM EMP E INNER JOIN DEPT D
ON E.DEPTNO = D.DEPTNO
--- SQL 표준 JOIN
SELECT E.ENAME, D.LOC FROM
EMP E INNER JOIN DEPT D 
USING (DEPTNO)
--- 제2 표준


SELECT E.ENAME,D.LOC FROM EMP E, DEPT D
WHERE E.DEPTNO = D.DEPTNO
AND E.JOB = 'MANAGER'
AND D.LOC = 'CHICAGO'


SELECT E.ENAME,D.LOC FROM EMP E INNER JOIN DEPT D
ON (E.DEPTNO = D.DEPTNO)
WHERE E.JOB = 'MANAGER'
AND D.LOC = 'CHICAGO'
```



VIEW  생성

CREATE VIEW T_EMP( ENO,EN,SAL,DNO)
AS
SELECT EMPNO, ENAME, SAL, DEPTNO FROM EMP

CREATE VIEW T_DEPT(DNO,DNM,LO)
AS
SELECT DEPTNO, DNAME, LOC FROM DEPT

CREATE VIEW T_SAL(ENO, ASAL)
AS
SELECT EMPNO, (SAL*12)+NVL((COMM*12),0) FROM EMP

##### 3개의 TABLE 조인

```SQL
SELECT E.ENO, E.EN, E.SAL, S.ASAL, D.DNM ,D.LO FROM
T_EMP E, T_DEPT D, T_SAL S
WHERE E.DNO = D.DNO AND E.ENO = S.ENO

SELECT E.ENO, E.EN, E.SAL, S.ASAL, D.DNM ,D.LO FROM
T_EMP E INNER JOIN T_DEPT D
ON (E.DNO = D.DNO)
INNER JOIN T_SAL S
ON (E.ENO = S.ENO)
```

직원의 정보를 출력하시오

EMPNO, ENAME, MNAME 을 출력하시오

##### SELF JOIN

``` SQL
SELECT E1.EMPNO AS EMPNO, E1.ENAME AS ENAME,E2.ENAME AS MNAME 
FROM EMP E1, EMP E2 WHERE E1.MGR=E2.EMPNO
```

##### OUTER JOIN

```sql
SELECT E.ENAME, E.JOB, D.DNAME, D.LOC
FROM EMP E, DEPT D
WHERE E.DEPTNO = D.DEPTNO(+)
--- + >> 반대족에 없는게 나옴

SELECT E.ENAME, E.JOB, D.DNAME, D.LOC
FROM EMP E LEFT OUTER JOIN DEPT D USING(DEPTNO)

EMP 기준 LEFT 왼쪽 조인

SELECT E.ENAME, E.JOB, D.DNAME, D.LOC
FROM EMP E FULL OUTER JOIN DEPT D USING(DEPTNO)

FULL 을 통해 다 출력


```

##### 순위 출력

```sql
SELECT ENAME, SAL, RANK() OVER (ORDER BY SAL) AS RANKING FROM EMP ORDER BY SAL

SELECT ENAME, SAL, 
RANK() OVER (ORDER BY SAL) AS RANKING,
DENSE_RANK() OVER (ORDER BY SAL DESC) AS D_RANKING,
ROW_NUMBER() OVER (ORDER BY SAL DESC) AS ROW_NUM
FROM EMP ORDER BY SAL


SELECT ENAME,SAL,RANK,TOTAL FROM (
SELECT ENAME,SAL ,
RANK() OVER(ORDER BY SAL DESC) AS RANK , 
(SELECT COUNT(*) FROM EMP) AS TOTAL
FROM EMP 
) WHERE RANK< 6
```

#### ROLL UP

```SQL
SELECT JOB,AVG(SAL), SUM(SAL) FROM EMP
GROUP BY ROLLUP(JOB)

---합계까 나옴
```

